<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HELPER BANGLA - Text Chat</title>
    <style>
        :root {
            --bg: #0f0f10; --sidebar: #18181b; --text: #f4f4f5;
            --input-bg: #27272a; --accent: #00d26a; --border: #3f3f46;
            --btn-hover: #2a2a2d;
        }
        [data-theme="light"] {
            --bg: #ffffff; --sidebar: #f7f7f8; --text: #1f1f1f;
            --input-bg: #ffffff; --accent: #00a854; --border: #e5e5e5;
            --btn-hover: #e0e0e0;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; transition: 0.2s; }
        body { background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        /* Auth Overlay */
        #auth-overlay { 
            position: fixed; top:0; left:0; width:100%; height:100%; 
            background: var(--bg) url('https://upload.wikimedia.org/wikipedia/commons/thumb/f/f9/Flag_map_of_Bangladesh.svg/1000px-Flag_map_of_Bangladesh.svg.png') no-repeat center;
            background-size: 35%; z-index: 9999; display: flex; align-items: center; justify-content: center; 
        }
        #auth-overlay::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 15, 16, 0.9); z-index: -1; }
        .auth-card { background: var(--sidebar); padding: 40px; border-radius: 16px; width: 380px; border: 1px solid var(--border); text-align: center; }
        .auth-card input { width: 100%; padding: 12px; margin: 10px 0; background: var(--input-bg); border: 1px solid var(--border); color: var(--text); border-radius: 8px; outline: none; }

        /* Sidebar */
        .sidebar { width: 280px; background: var(--sidebar); padding: 15px; border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .brand { font-size: 1.4rem; font-weight: bold; color: var(--accent); padding: 10px; text-align: center; border-bottom: 1px solid var(--border); margin-bottom: 15px; }
        
        /* Buttons */
        .new-btn { background: var(--accent); color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 20px; width: 100%; }
        .new-btn:hover { opacity: 0.9; }

        .action-btn { 
            width: 100%; 
            padding: 12px 15px; 
            margin-top: 8px; 
            background: transparent; 
            border: 1px solid var(--border); 
            color: var(--text); 
            border-radius: 8px; 
            cursor: pointer; 
            text-align: left; 
            font-size: 14px; 
            display: flex; 
            align-items: center; 
            gap: 10px;
        }
        .action-btn:hover { background: var(--btn-hover); border-color: var(--text); }
        
        .history-list { flex: 1; overflow-y: auto; }
        .history-item { padding: 12px; border-radius: 8px; cursor: pointer; font-size: 14px; margin-bottom: 5px; background: rgba(255,255,255,0.03); }
        .history-item.active { border-left: 4px solid var(--accent); background: var(--input-bg); }

        /* Chat Area */
        .main { flex: 1; display: flex; flex-direction: column; }
        #chat-window { flex: 1; overflow-y: auto; padding: 40px 15%; display: flex; flex-direction: column; gap: 20px; }
        .msg { max-width: 85%; padding: 15px 20px; border-radius: 18px; line-height: 1.6; white-space: pre-wrap; }
        .user { align-self: flex-end; background: var(--accent); color: white; border-bottom-right-radius: 2px; }
        .bot { align-self: flex-start; background: var(--input-bg); border: 1px solid var(--border); border-bottom-left-radius: 2px; }

        .input-area { padding: 20px 15%; }
        .input-box { background: var(--input-bg); border-radius: 15px; display: flex; padding: 8px 15px; border: 1px solid var(--border); align-items: center; }
        input#userInput { flex: 1; background: none; border: none; color: inherit; outline: none; padding: 10px; font-size: 16px; }

        @media print { .sidebar, .input-area, #auth-overlay { display: none; } }
    </style>
</head>
<body data-theme="dark">

<div id="auth-overlay">
    <div class="auth-card">
        <h1>HELPER BANGLA</h1>
        <p style="color: gray; margin-bottom: 20px;">Intelligent Assistant</p>
        <button class="new-btn" onclick="document.getElementById('auth-overlay').style.display='none'">Login</button>
    </div>
</div>

<aside class="sidebar">
    <div class="brand">HELPER BANGLA</div>
    <button class="new-btn" onclick="location.reload()">ï¼‹ New Chat</button>
    <div class="history-list" id="history-container"></div>
    
    <div style="padding-top: 15px; border-top: 1px solid var(--border);">
        <button class="action-btn" onclick="window.print()">ðŸ“„ Export as PDF</button>
        <button class="action-btn" onclick="toggleTheme()">ðŸŒ“ Toggle Theme</button>
    </div>
</aside>

<main class="main">
    <div id="chat-window">
        <div style="text-align: center; margin: auto; max-width: 500px;" id="welcome-msg">
            <h1 style="color:var(--accent); font-size: 2.5rem;">Assalamu Alaikum</h1>
            <p>I am Helper Bangla. How can I help you today?</p>
        </div>
    </div>
    <div class="input-area">
        <div class="input-box">
            <input type="text" id="userInput" placeholder="Ask Helper Bangla..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button onclick="sendMessage()" style="background:none; border:none; color:var(--accent); cursor:pointer; font-size: 1.5rem; padding-left: 10px;">âž¤</button>
        </div>
    </div>
</main>

<script>
    const GROQ_KEY = "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";
    const API_URL = "https://api.groq.com/openai/v1/chat/completions";

    let allChats = JSON.parse(localStorage.getItem('hb_sessions')) || [];
    let currentId = Date.now().toString();

    async function sendMessage() {
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        if (!text) return;

        if(document.getElementById('welcome-msg')) document.getElementById('welcome-msg').remove();
        
        addMsg(text, 'user');
        input.value = "";
        const botMsg = addMsg("Thinking...", 'bot');

        try {
            const response = await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json", "Authorization": `Bearer ${GROQ_KEY}` },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: [
                        { role: "system", content: "You are Helper Bangla. Respond helpfully. Use Bengali if the user speaks Bengali." },
                        { role: "user", content: text }
                    ]
                })
            });
            const data = await response.json();
            const aiResponse = data.choices[0].message.content;
            botMsg.innerText = aiResponse;
            saveChat(text, aiResponse);
        } catch (e) { botMsg.innerText = "Error: Check API connection."; }
    }

    function addMsg(text, type) {
        const div = document.createElement('div');
        div.className = `msg ${type}`;
        div.innerText = text;
        const win = document.getElementById('chat-window');
        win.appendChild(div);
        win.scrollTop = win.scrollHeight;
        return div;
    }

    function saveChat(u, a) {
        let chat = allChats.find(c => c.id === currentId);
        if (!chat) {
            chat = { id: currentId, title: u.substring(0, 25) + "...", msgs: [] };
            allChats.unshift(chat);
        }
        chat.msgs.push({ u, a });
        localStorage.setItem('hb_sessions', JSON.stringify(allChats));
        renderSidebar();
    }

    function renderSidebar() {
        const container = document.getElementById('history-container');
        container.innerHTML = "";
        allChats.forEach(chat => {
            const item = document.createElement('div');
            item.className = `history-item ${chat.id === currentId ? 'active' : ''}`;
            item.innerHTML = `<span>${chat.title}</span>`;
            item.onclick = () => {
                currentId = chat.id;
                document.getElementById('chat-window').innerHTML = "";
                chat.msgs.forEach(m => { addMsg(m.u, 'user'); addMsg(m.a, 'bot'); });
                renderSidebar();
            };
            container.appendChild(item);
        });
    }

    function toggleTheme() {
        document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
    }

    renderSidebar();
</script>
</body>
</html>
